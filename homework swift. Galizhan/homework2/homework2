import Foundation

func sendTelegramMessage(message: String) {
    let botToken = "AAHfBElWsSGIrcEsLj8ZcAnTPf5ZSoD0slI"
    let chatID = 1324654836
    let urlString = "https://api.telegram.org/bot\(botToken)/sendMessage?chat_id=\(chatID)&text=\(message)"
    
    guard let url = URL(string: urlString) else {
        print("Error: Invalid URL")
        return
    }
    
    let task = URLSession.shared.dataTask(with: url) { data, response, error in
        if let error = error {
            print("Error sending message: \(error.localizedDescription)")
        }
    }
    task.resume()
}

func applicationDidFinishLaunching(_ aNotification: Notification) {
    incrementBuildNumber()
    let version = Bundle.main.object(forInfoDictionaryKey: "CFBundleShortVersionString") as? String ?? ""
    let buildNumber = ProcessInfo.processInfo.environment["BUILD_NUMBER"] ?? ""
    let message = "Привет Друг! Сборка проекта успешно завершена! Версия приложения: \(version) Номер билда: \(buildNumber)"
    sendTelegramMessage(message: message)
}

func incrementBuildNumber() {
    if let buildNumber = Int(ProcessInfo.processInfo.environment["BUILD_NUMBER"] ?? "") {
        let newBuildNumber = buildNumber + 1
        ProcessInfo.processInfo.environment["BUILD_NUMBER"] = "\(newBuildNumber)"
    }
}